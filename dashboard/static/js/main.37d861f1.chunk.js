(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{120:function(e,t,a){},130:function(e,t,a){},135:function(e,t,a){},139:function(e,t,a){},141:function(e,t,a){"use strict";a.r(t);var n=a(0),s=a.n(n),r=a(21),l=a.n(r),i=a(149),c=a(143),o=a(142),m=a(2),u=a(4),d=a.n(u),h=function(){return s.a.createElement(m.o,{className:"main-navbar__search w-100 d-none d-md-flex d-lg-flex"},s.a.createElement(m.s,{seamless:!0,className:"ml-3"},s.a.createElement(m.t,{type:"prepend"},s.a.createElement(m.u,null,s.a.createElement("i",{className:"material-icons"},"search"))),s.a.createElement(m.q,{className:"navbar-search",placeholder:"Search for something..."})))},p=a(6),g=a(7),b=a(9),f=a(8),E=a(10),v=a(3),y=function(e){function t(e){var a;return Object(p.a)(this,t),(a=Object(b.a)(this,Object(f.a)(t).call(this,e))).state={visible:!1},a.toggleNotifications=a.toggleNotifications.bind(Object(v.a)(Object(v.a)(a))),a}return Object(E.a)(t,e),Object(g.a)(t,[{key:"toggleNotifications",value:function(){this.setState({visible:!this.state.visible})}},{key:"render",value:function(){return s.a.createElement(m.w,{className:"border-right dropdown notifications"},s.a.createElement(m.x,{className:"nav-link-icon text-center",onClick:this.toggleNotifications},s.a.createElement("div",{className:"nav-link-icon__wrapper"},s.a.createElement("i",{className:"material-icons"},"\ue7f4"),s.a.createElement(m.b,{pill:!0,theme:"danger"},"2"))),s.a.createElement(m.h,{open:this.state.visible,className:"dropdown-menu dropdown-menu-small"},s.a.createElement(m.l,null,s.a.createElement("div",{className:"notification__icon-wrapper"},s.a.createElement("div",{className:"notification__icon"},s.a.createElement("i",{className:"material-icons"},"\ue6e1"))),s.a.createElement("div",{className:"notification__content"},s.a.createElement("span",{className:"notification__category"},"Analytics"),s.a.createElement("p",null,"Your website\u2019s active users count increased by"," ",s.a.createElement("span",{className:"text-success text-semibold"},"28%")," in the last week. Great job!"))),s.a.createElement(m.l,null,s.a.createElement("div",{className:"notification__icon-wrapper"},s.a.createElement("div",{className:"notification__icon"},s.a.createElement("i",{className:"material-icons"},"\ue8d1"))),s.a.createElement("div",{className:"notification__content"},s.a.createElement("span",{className:"notification__category"},"Sales"),s.a.createElement("p",null,"Last week your store\u2019s sales count decreased by"," ",s.a.createElement("span",{className:"text-danger text-semibold"},"5.52%"),". It could have been worse!"))),s.a.createElement(m.l,{className:"notification__all text-center"},"View all Notifications")))}}]),t}(s.a.Component),N=a(52),O=function(e){function t(e){var a;return Object(p.a)(this,t),(a=Object(b.a)(this,Object(f.a)(t).call(this,e))).state={visible:!1},a.toggleUserActions=a.toggleUserActions.bind(Object(v.a)(Object(v.a)(a))),a}return Object(E.a)(t,e),Object(g.a)(t,[{key:"toggleUserActions",value:function(){this.setState({visible:!this.state.visible})}},{key:"render",value:function(){return s.a.createElement(m.w,{tag:m.k,caret:!0,toggle:this.toggleUserActions},s.a.createElement(m.n,{caret:!0,tag:m.x,className:"text-nowrap px-3"},s.a.createElement("img",{className:"user-avatar rounded-circle mr-2",src:a(99),alt:"User Avatar"})," ",s.a.createElement("span",{className:"d-none d-md-inline-block"},"Sierra Brooks")),s.a.createElement(m.h,{tag:m.m,right:!0,small:!0,open:this.state.visible},s.a.createElement(m.l,{tag:N.a,to:"profile"},s.a.createElement("i",{className:"material-icons"},"\ue7fd")," Profile"),s.a.createElement(m.l,{divider:!0}),s.a.createElement(m.l,{tag:N.a,to:"/logout",className:"text-danger"},s.a.createElement("i",{className:"material-icons text-danger"},"\ue879")," Logout")))}}]),t}(s.a.Component),j=function(){return s.a.createElement(m.v,{navbar:!0,className:"border-left flex-row"},s.a.createElement(y,null),s.a.createElement(O,null))},D="CHANGE",S="TOGGLE_SIDEBAR",x="GET_STATIONS",C="CHECK_INIT",A="EVENT_STATIONS_READY",k="EVENT_VARIABLES_READY",w="EVENT_USER_READY",L=new(a(66).Dispatcher),T=a(67),V=a(18),_=a.n(V),M={menuVisible:!1,navItems:[{title:"Map",htmlBefore:'<i class="material-icons">vertical_split</i>',to:"/map"},{title:"Graphs",htmlBefore:'<i class="material-icons">insert_chart</i>',to:"/visualize"},{title:"Data export",htmlBefore:'<i class="material-icons">cloud_download</i>',to:"/export"},{title:"User management",htmlBefore:'<i class="material-icons">supervisor_account</i>',to:"/group-moderator",moderatorOnly:!0},{title:"User management",htmlBefore:'<i class="material-icons">account_box</i>',to:"/user-management",adminOnly:!0}],stations:[],variables:[],stationAccess:[],variableAccess:[],user:{},initInProgress:!1,initCompleted:!1,aggregation:{"1H":"Hourly","1D":"Daily","1M":"Monthly"}},I=new(function(e){function t(){var e;return Object(p.a)(this,t),(e=Object(b.a)(this,Object(f.a)(t).call(this))).registerToActions=e.registerToActions.bind(Object(v.a)(Object(v.a)(e))),e.toggleSidebar=e.toggleSidebar.bind(Object(v.a)(Object(v.a)(e))),L.register(e.registerToActions.bind(Object(v.a)(Object(v.a)(e)))),e.init(),e}return Object(E.a)(t,e),Object(g.a)(t,[{key:"registerToActions",value:function(e){var t=e.actionType;e.payload;switch(t){case S:this.toggleSidebar();break;case C:this.checkInit();break;case x:this.retrieveStations()}}},{key:"toggleSidebar",value:function(){M.menuVisible=!M.menuVisible,this.emit(D)}},{key:"getMenuState",value:function(){return M.menuVisible}},{key:"getSidebarItems",value:function(){var e=M.navItems;return M.user.role&&"admin"===M.user.role||(e=e.filter(function(e){return!e.adminOnly})),M.user.groupRole&&"moderator"===M.user.groupRole||(e=e.filter(function(e){return!e.moderatorOnly})),e}},{key:"checkInit",value:function(){M.initCompleted?(this.emit(A),this.emit(k),this.emit(w)):M.initInProgress||this.init()}},{key:"init",value:function(){var e=this;M.initInProgress=!0,_.a.get("/init").then(function(e){return e.data}).then(function(t){M.stations=t.stations,M.stationAccess=t.stationAccess,e.emit(A),M.variables=t.variables,M.variableAccess=t.variableAccess,e.emit(k),M.user=t.user,e.emit(w),e.emit(D),M.initInProgress=!1,M.initCompleted=!0})}},{key:"retrieveStations",value:function(){var e=this;M.stations.length>0?this.emit(A):_.a.get("/services/assets/v2/stations?sort=code").then(function(e){return e.data}).then(function(t){M.stations=t.data,e.emit(A)})}},{key:"getStations",value:function(){return M.stations}},{key:"getAccessStationCodes",value:function(){return M.stationAccess}},{key:"getVariables",value:function(){return M.variables}},{key:"getAccessVariableCodes",value:function(){return M.variableAccess}},{key:"getAggregations",value:function(){return M.aggregation}},{key:"getAccessAggregations",value:function(){return"access"in M.user&&"aggregation"in M.user.access?!0===M.user.access.aggregation.unlimited?Object.keys(M.aggregation):M.user.access.aggregation.specific:[]}},{key:"getUser",value:function(){return M.user}},{key:"addChangeListener",value:function(e){this.on(D,e)}},{key:"removeChangeListener",value:function(e){this.removeListener(D,e)}}]),t}(T.EventEmitter)),R=function(e){function t(e){var a;return Object(p.a)(this,t),(a=Object(b.a)(this,Object(f.a)(t).call(this,e))).handleClick=a.handleClick.bind(Object(v.a)(Object(v.a)(a))),a}return Object(E.a)(t,e),Object(g.a)(t,[{key:"handleClick",value:function(){L.dispatch({actionType:S})}},{key:"render",value:function(){return s.a.createElement("nav",{className:"nav"},s.a.createElement("a",{href:"#",onClick:this.handleClick,className:"nav-link nav-link-icon toggle-sidebar d-sm-inline d-md-inline d-lg-none text-center"},s.a.createElement("i",{className:"material-icons"},"\ue5d2")))}}]),t}(s.a.Component),U=function(e){e.layout;var t=e.stickyTop,a=d()("main-navbar","bg-white",t&&"sticky-top");return s.a.createElement("div",{className:a},s.a.createElement(m.i,{className:"p-0"},s.a.createElement(m.y,{type:"light",className:"align-items-stretch flex-md-nowrap p-0"},s.a.createElement(h,null),s.a.createElement(j,null),s.a.createElement(R,null))))};U.defaultProps={stickyTop:!0};var G=U,B=a(11),P=function(e){function t(e){var a;return Object(p.a)(this,t),(a=Object(b.a)(this,Object(f.a)(t).call(this,e))).handleToggleSidebar=a.handleToggleSidebar.bind(Object(v.a)(Object(v.a)(a))),a}return Object(E.a)(t,e),Object(g.a)(t,[{key:"handleToggleSidebar",value:function(){L.dispatch({actionType:S})}},{key:"render",value:function(){var e=this.props.hideLogoText;return s.a.createElement("div",{className:"main-navbar"},s.a.createElement(m.y,{className:"align-items-stretch bg-white flex-md-nowrap border-bottom p-0",type:"light"},s.a.createElement(m.z,{className:"w-100 mr-0",href:"#",style:{lineHeight:"25px"}},s.a.createElement("div",{className:"d-table m-auto"},!e&&s.a.createElement("span",{className:"d-none d-md-inline ml-1"},"DGM data portal"))),s.a.createElement("a",{className:"toggle-sidebar d-sm-inline d-md-none d-lg-none",onClick:this.handleToggleSidebar},s.a.createElement("i",{className:"material-icons"},"\ue5c4"))))}}]),t}(s.a.Component);P.defaultProps={hideLogoText:!1};var Y=P,W=function(){return s.a.createElement(m.o,{className:"main-sidebar__search w-100 border-right d-sm-flex d-md-none d-lg-none",style:{display:"flex",minHeight:"45px"}},s.a.createElement(m.s,{seamless:!0,className:"ml-3"},s.a.createElement(m.t,{type:"prepend"},s.a.createElement(m.u,null,s.a.createElement("i",{className:"material-icons"},"search")),s.a.createElement(m.q,{className:"navbar-search",placeholder:"Search for something...","aria-label":"Search"}))))},z=a(146),F=function(e){var t=e.item;return s.a.createElement(m.w,null,s.a.createElement(m.x,{tag:z.a,to:t.to},t.htmlBefore&&s.a.createElement("div",{className:"d-inline-block item-icon-wrapper",dangerouslySetInnerHTML:{__html:t.htmlBefore}}),t.title&&s.a.createElement("span",null,t.title),t.htmlAfter&&s.a.createElement("div",{className:"d-inline-block item-icon-wrapper",dangerouslySetInnerHTML:{__html:t.htmlAfter}})))},H=function(e){function t(e){var a;return Object(p.a)(this,t),(a=Object(b.a)(this,Object(f.a)(t).call(this,e))).state={navItems:I.getSidebarItems()},a.onChange=a.onChange.bind(Object(v.a)(Object(v.a)(a))),a}return Object(E.a)(t,e),Object(g.a)(t,[{key:"componentWillMount",value:function(){I.addChangeListener(this.onChange)}},{key:"componentWillUnmount",value:function(){I.removeChangeListener(this.onChange)}},{key:"onChange",value:function(){this.setState(Object(B.a)({},this.state,{navItems:I.getSidebarItems()}))}},{key:"render",value:function(){var e=this.state.navItems;return s.a.createElement("div",{className:"nav-wrapper"},s.a.createElement(m.v,{className:"nav--no-borders flex-column"},e.map(function(e,t){return s.a.createElement(F,{key:t,item:e})}),s.a.createElement("li",{className:"nav-item"},s.a.createElement("a",{className:"nav-link","aria-current":"page",href:"/logout"},s.a.createElement("div",{className:"d-inline-block item-icon-wrapper"},s.a.createElement("i",{className:"material-icons"},"exit_to_app")),s.a.createElement("span",null,"Logout")))))}}]),t}(s.a.Component),q=function(e){function t(e){var a;return Object(p.a)(this,t),(a=Object(b.a)(this,Object(f.a)(t).call(this,e))).state={menuVisible:!1,sidebarNavItems:I.getSidebarItems()},a.onChange=a.onChange.bind(Object(v.a)(Object(v.a)(a))),a}return Object(E.a)(t,e),Object(g.a)(t,[{key:"componentWillMount",value:function(){I.addChangeListener(this.onChange)}},{key:"componentWillUnmount",value:function(){I.removeChangeListener(this.onChange)}},{key:"onChange",value:function(){this.setState(Object(B.a)({},this.state,{menuVisible:I.getMenuState(),sidebarNavItems:I.getSidebarItems()}))}},{key:"render",value:function(){var e=d()("main-sidebar","px-0","col-12",this.state.menuVisible&&"open");return s.a.createElement(m.g,{tag:"aside",className:e,lg:{size:2},md:{size:3}},s.a.createElement(Y,{hideLogoText:this.props.hideLogoText}),s.a.createElement(W,null),s.a.createElement(H,null))}}]),t}(s.a.Component);q.defaultProps={hideLogoText:!1};var Z=q,J=function(e){var t=e.contained,a=e.menuItems,n=e.copyright;return s.a.createElement("footer",{className:"main-footer d-flex p-2 px-3 bg-white border-top"},s.a.createElement(m.i,{fluid:t},s.a.createElement(m.A,null,s.a.createElement(m.v,null,a.map(function(e,t){return s.a.createElement(m.w,{key:t},s.a.createElement(m.x,{tag:N.a,to:e.to},e.title))})),s.a.createElement("span",{className:"copyright ml-auto my-auto mr-2"},n))))};J.defaultProps={contained:!1,copyright:"Copyright \xa9 2018 DesignRevision",menuItems:[{title:"Home",to:"#"},{title:"Services",to:"#"},{title:"About",to:"#"},{title:"Products",to:"#"},{title:"Blog",to:"#"}]};var K=J,X=function(e){function t(e){var a;return Object(p.a)(this,t),(a=Object(b.a)(this,Object(f.a)(t).call(this,e))).updateDemo=a.updateDemo.bind(Object(v.a)(Object(v.a)(a))),a.state={demo:!1},a}return Object(E.a)(t,e),Object(g.a)(t,[{key:"componentWillMount",value:function(){I.on(w,this.updateDemo)}},{key:"componentWillUnmount",value:function(){I.removeListener(w,this.updateDemo)}},{key:"updateDemo",value:function(){var e=I.getUser();this.setState({demo:e.demo})}},{key:"render",value:function(){return s.a.createElement("div",null,!0===this.state.demo&&s.a.createElement(m.i,{fluid:!0,className:"px-0 alert-message",style:{position:"relative",zIndex:999}},s.a.createElement(m.a,{className:"mb-0"},s.a.createElement("i",{className:"fa fa-info mx-2"})," Your account hasn't been configured yet, therefore you only have access to demo stations and limited datasets.")))}}]),t}(s.a.Component),$=function(e){var t=e.children,a=e.noNavbar,n=e.noFooter;return s.a.createElement(m.i,{fluid:!0},s.a.createElement(m.A,null,s.a.createElement(Z,null),s.a.createElement(m.g,{className:"main-content p-0",lg:{size:10,offset:2},md:{size:9,offset:3},sm:"12",tag:"main"},!a&&s.a.createElement(G,null),s.a.createElement(X,null),t,!n&&s.a.createElement(K,null))))};$.defaultProps={noNavbar:!0,noFooter:!0};var Q=$,ee=a(23),te=a.n(ee),ae=a(72),ne=function(e){var t=e.title,a=e.subtitle,n=e.className,r=Object(ae.a)(e,["title","subtitle","className"]),l=d()(n,"text-center","text-md-left","mb-sm-0");return s.a.createElement(m.g,Object.assign({xs:"12",sm:"4",className:l},r),s.a.createElement("span",{className:"text-uppercase page-subtitle"},a),s.a.createElement("h3",{className:"page-title"},t))},se=(a(120),function(e){function t(e){var a;return Object(p.a)(this,t),(a=Object(b.a)(this,Object(f.a)(t).call(this,e))).state={startDate:void 0,endDate:void 0,minDate:e.minDate?e.minDate:void 0,maxDate:e.maxDate?e.maxDate:void 0},a.handleStartDateChange=a.handleStartDateChange.bind(Object(v.a)(Object(v.a)(a))),a.handleEndDateChange=a.handleEndDateChange.bind(Object(v.a)(Object(v.a)(a))),a}return Object(E.a)(t,e),Object(g.a)(t,[{key:"changeLimit",value:function(e,t){this.setState({minDate:e,maxDate:t})}},{key:"setDates",value:function(e,t){this.handleStartDateChange(e),this.handleEndDateChange(t)}},{key:"handleStartDateChange",value:function(e){this.setState(Object(B.a)({},this.state,{startDate:new Date(e)}))}},{key:"handleEndDateChange",value:function(e){this.setState(Object(B.a)({},this.state,{endDate:new Date(e)}))}},{key:"render",value:function(){var e=this.props.className,t=d()(e,"d-flex","my-auto","date-range");return s.a.createElement(m.s,{className:t},s.a.createElement(m.j,{size:"sm",dateFormat:"yyyy-MM-dd",selected:this.state.startDate,onChange:this.handleStartDateChange,minDate:this.state.minDate,maxDate:this.state.maxDate,placeholderText:"Start Date",dropdownMode:"select",className:"text-center"}),s.a.createElement(m.j,{size:"sm",dateFormat:"yyyy-MM-dd",selected:this.state.endDate,onChange:this.handleEndDateChange,minDate:this.state.minDate,maxDate:this.state.maxDate,placeholderText:"End Date",dropdownMode:"select",className:"text-center"}),s.a.createElement(m.t,{type:"append"},s.a.createElement(m.u,null,s.a.createElement("i",{className:"material-icons"},"\ue916"))))}}]),t}(s.a.Component)),re=function(e){function t(e){var a;return Object(p.a)(this,t),(a=Object(b.a)(this,Object(f.a)(t).call(this,e))).dateRangeReference=s.a.createRef(),a.handleVariableChange=a.handleVariableChange.bind(Object(v.a)(Object(v.a)(a))),a.handleStationChange=a.handleStationChange.bind(Object(v.a)(Object(v.a)(a))),a.startExport=a.startExport.bind(Object(v.a)(Object(v.a)(a))),a.change=a.change.bind(Object(v.a)(Object(v.a)(a))),a.submit=a.submit.bind(Object(v.a)(Object(v.a)(a))),a.updateStations=a.updateStations.bind(Object(v.a)(Object(v.a)(a))),a.updateVariables=a.updateVariables.bind(Object(v.a)(Object(v.a)(a))),a.updateAccess=a.updateAccess.bind(Object(v.a)(Object(v.a)(a))),a.state={show:!1,startDate:"",endDate:"",aggregation:null,variables:{ap:!0,pr:!0,rh:!0,ra:!0,te:!0,wd:!0,wg:!0,ws:!0},variableList:[],stations:{},stationList:[],filterString:"",description:"",multiSelect:!1,aggregations:I.getAggregations(),aggregationAccess:[],minDate:new Date("2015-01-01"),maxDate:new Date},a}return Object(E.a)(t,e),Object(g.a)(t,[{key:"handleVariableChange",value:function(e,t){var a={variables:this.state.variables};a.variables[t]=!this.state.variables[t],this.setState(Object(B.a)({},this.state,a))}},{key:"handleStationChange",value:function(e,t){var a={stations:this.state.stations};a.stations[t]=!this.state.stations[t],this.setState(Object(B.a)({},this.state,a))}},{key:"handleMultiSelectChange",value:function(){var e=this,t=!this.state.multiSelect,a=this.state.stations;this.state.stationList.filter(function(t){return t.location.name.toLowerCase().includes(e.state.filterString)||t.code.toLowerCase().includes(e.state.filterString)}).map(function(e){a[e.code]=t});var n={multiSelect:t,stations:a};this.setState(Object(B.a)({},this.state,n))}},{key:"change",value:function(e,t){var a={};a[e]=t,"filterString"==e&&(a.multiSelect=!1),this.setState(Object(B.a)({},this.state,a))}},{key:"startExport",value:function(e){this.setState(Object(B.a)({},this.state,{show:!0}))}},{key:"submit",value:function(){var e=this,t=[],a=this.dateRangeReference.current,n={aggregation:this.state.aggregation,variables:[],stations:[],startDate:null,endDate:null};(!a.state.startDate||!a.state.startDate instanceof Date)&&t.push("Invalid start date"),(!a.state.endDate||!a.state.endDate instanceof Date)&&t.push("Invalid end date");for(var s=0,r=Object.keys(this.state.stations);s<r.length;s++){var l=r[s];this.state.stations[l]&&n.stations.push(l)}for(var i=function(){var t=o[c];e.state.variables[t]&&e.state.variableList.find(function(e){return e.shortcode===t})&&n.variables.push(t)},c=0,o=Object.keys(this.state.variables);c<o.length;c++)i();if(0==n.stations.length&&t.push("There are no stations selected."),0==n.variables.length&&t.push("There are no variables selected."),t.length>0)return alert("Data export failed:\n"+t.join("\n")),!1;n.startDate=a.state.startDate.getFullYear()+"-"+("0"+(a.state.startDate.getMonth()+1)).slice(-2)+"-"+("0"+a.state.startDate.getDate()).slice(-2)+"T00:00:00.000Z",n.endDate=a.state.endDate.getFullYear()+"-"+("0"+(a.state.endDate.getMonth()+1)).slice(-2)+"-"+("0"+a.state.endDate.getDate()).slice(-2)+"T23:59:59.000Z",n.description=this.state.description,_()({url:"/export",method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},data:n}).then(function(e){return e.data}).then(function(e){"success"===e.status?window.location.reload():alert("Data export failed:\n"+e.error)}).catch(function(e){alert("Data export failed.")})}},{key:"updateStations",value:function(){var e=I.getAccessStationCodes(),t=I.getStations().filter(function(t){return-1!==e.indexOf(t.code)});this.setState({stationList:t})}},{key:"updateVariables",value:function(){var e=I.getAccessVariableCodes(),t=I.getVariables().filter(function(t){return-1!==e.indexOf(t.shortcode)});this.setState({variableList:t})}},{key:"updateAccess",value:function(){var e=I.getAccessAggregations();null===this.state.aggregation&&e.length>0&&this.setState({aggregation:e[0]});var t=I.getUser();te.a.has(t,"access.period.unlimited")&&!0!==t.access.period.unlimited&&(this.setState({minDate:new Date(t.access.period.startDate),maxDate:new Date>new Date(t.access.period.endDate)?new Date(t.access.period.endDate):new Date}),this.dateRangeReference.current&&this.dateRangeReference.current.changeLimit(this.state.minDate,this.state.maxDate)),this.setState({aggregationAccess:e})}},{key:"componentWillMount",value:function(){I.on(A,this.updateStations),I.on(k,this.updateVariables),I.on(w,this.updateAccess)}},{key:"componentWillUnmount",value:function(){I.removeListener(A,this.updateStations),I.removeListener(k,this.updateVariables),I.removeListener(w,this.updateAccess)}},{key:"componentDidMount",value:function(){L.dispatch({actionType:C})}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{id:"export-create"},s.a.createElement(m.A,{noGutters:!0,className:"page-header py-4"},s.a.createElement(ne,{sm:"4",title:"Create export",subtitle:"",className:"text-sm-left"})),!this.state.show&&s.a.createElement(m.A,null,s.a.createElement(m.g,null,s.a.createElement("p",{onClick:this.startExport},s.a.createElement("a",{href:"#export-create"},"Click here")," to start a new export."))),this.state.show&&s.a.createElement("div",null,s.a.createElement(m.A,null,s.a.createElement(m.g,null,s.a.createElement(m.d,{small:!0,className:"mb-4"},s.a.createElement(m.f,{className:"border-bottom"},s.a.createElement("h6",{className:"m-0"},"Export settings")),s.a.createElement(m.e,{className:"pt-0"},s.a.createElement(m.A,{className:"border-bottom"},s.a.createElement(m.g,{sm:"3",className:"d-flex mb-3 mt-3"},"Period"),s.a.createElement(m.g,{sm:"3",className:"d-flex mb-2 mt-2"},s.a.createElement(se,{ref:this.dateRangeReference,minDate:this.state.minDate,maxDate:this.state.maxDate}))),s.a.createElement(m.A,{className:"border-bottom"},s.a.createElement(m.g,{sm:"3",className:"d-flex mb-2 mt-3"},"Data type"),s.a.createElement(m.g,{sm:"3",className:"d-flex mb-2 mt-2"},s.a.createElement(m.s,null,s.a.createElement(m.t,{type:"prepend"},s.a.createElement(m.u,null,"Aggregation")),s.a.createElement(m.r,{onChange:function(t){return e.change("aggregation",t.target.value)}},this.state.aggregationAccess.map(function(t){return s.a.createElement("option",{value:t},e.state.aggregations[t])}))))),s.a.createElement(m.A,{className:"border-bottom"},s.a.createElement(m.g,{sm:"3",className:"d-flex mb-3 mt-3"},"Variables"),s.a.createElement(m.g,{sm:"4",md:"3",className:"mb-2 mt-2"},s.a.createElement("strong",{className:"text-muted d-block mb-2"},"Standard variables"),s.a.createElement("fieldset",null,this.state.variableList.filter(function(e){return!0===e.standard}).map(function(t){return s.a.createElement(m.p,{checked:e.state.variables[t.shortcode],onChange:function(a){return e.handleVariableChange(a,t.shortcode)}},t.description)}))),this.state.variableList.filter(function(e){return!1===e.standard}).length>0&&s.a.createElement(m.g,{sm:"4",md:"3",className:"mb-2 mt-2"},s.a.createElement("strong",{className:"text-muted d-block mb-2"},"Other variables"),s.a.createElement("fieldset",null,this.state.variableList.filter(function(e){return!1===e.standard}).map(function(t){return s.a.createElement(m.p,{checked:e.state.variables[t.shortcode],onChange:function(a){return e.handleVariableChange(a,t.shortcode)}},t.description)})))),s.a.createElement(m.A,null,s.a.createElement(m.g,{sm:"3",className:"d-flex mb-3 mt-3"},"Description (optional)"),s.a.createElement(m.g,{sm:"3",className:"d-flex mb-2 mt-2"},s.a.createElement(m.q,{placeholder:"",onChange:function(t){return e.change("description",t.target.value)}}))))))),s.a.createElement(m.A,null,s.a.createElement(m.g,null,s.a.createElement(m.d,{small:!0,className:"mb-2"},s.a.createElement(m.f,{className:"border-bottom"},s.a.createElement("h6",{className:"m-0"},"Stations")),s.a.createElement(m.e,{className:"p-0 pb-3"},s.a.createElement(m.A,{className:"border-bottom"},s.a.createElement(m.g,{sm:"3",className:"d-flex mb-2 mt-3 ml-3"},s.a.createElement(m.s,{className:"mb-3"},s.a.createElement(m.t,{type:"prepend"},s.a.createElement(m.u,null,"Filter")),s.a.createElement(m.q,{onChange:function(t){return e.change("filterString",t.target.value.toLowerCase())},placeholder:"e.g. station id or station name"})))),s.a.createElement("table",{className:"table mb-0"},s.a.createElement("thead",{className:"bg-light"},s.a.createElement("tr",null,s.a.createElement("th",{scope:"col",className:"border-0"},s.a.createElement(m.p,{className:"mb-0",checked:this.state.multiSelect,onChange:function(t){return e.handleMultiSelectChange(t)}})),s.a.createElement("th",{scope:"col",className:"border-0"},"Station id"),s.a.createElement("th",{scope:"col",className:"border-0"},"Location name"),s.a.createElement("th",{scope:"col",className:"border-0"},"Latitude"),s.a.createElement("th",{scope:"col",className:"border-0"},"Longitude"))),s.a.createElement("tbody",null,this.state.stationList.filter(function(t){return t.location.name.toLowerCase().includes(e.state.filterString)||t.code.toLowerCase().includes(e.state.filterString)}).map(function(t){return s.a.createElement("tr",null,s.a.createElement("td",null,s.a.createElement(m.p,{className:"mb-0",checked:e.state.stations[t.code],onChange:function(a){return e.handleStationChange(a,t.code)}})),s.a.createElement("td",null,t.code),s.a.createElement("td",null,t.location.name),s.a.createElement("td",null,t.location.latitude),s.a.createElement("td",null,t.location.longitude))}))))),s.a.createElement(m.c,{theme:"primary",onClick:this.submit,className:"mb-4 mr-1"},"Create export")))))}}]),t}(s.a.Component),le=a(32),ie=a.n(le),ce=function(e){function t(e){var a;return Object(p.a)(this,t),(a=Object(b.a)(this,Object(f.a)(t).call(this,e))).expandList=a.expandList.bind(Object(v.a)(Object(v.a)(a))),a.state={exportList:[],showNumber:5,aggregations:I.getAggregations(),expanded:!1},a}return Object(E.a)(t,e),Object(g.a)(t,[{key:"componentDidMount",value:function(){this.refreshList(!0),setInterval(this.refreshList.bind(this),1e4)}},{key:"refreshList",value:function(e){var t=this;(e||this.state.exportList.filter(function(e){return"completed"!==e.status}).length>0)&&_.a.get("/export").then(function(e){return e.data}).then(function(e){return t.setState({exportList:e.exports})})}},{key:"expandList",value:function(e){this.setState(Object(B.a)({},this.state,{expanded:!0,showNumber:100}))}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{id:"export-history"},s.a.createElement(m.A,{noGutters:!0,className:"page-header py-4"},s.a.createElement(ne,{sm:"4",title:"Data export",subtitle:"",className:"text-sm-left"})),s.a.createElement(m.A,null,s.a.createElement(m.g,null,s.a.createElement(m.d,{small:!0,className:"mb-4"},s.a.createElement(m.f,{className:"border-bottom"},s.a.createElement("h6",{className:"m-0"},"Export history",this.state.exportList.length>this.state.showNumber&&s.a.createElement("span",null,"\xa0-\xa0",s.a.createElement("a",{href:"#export-history",onClick:this.expandList},"(show all ",this.state.exportList.length,")")))),s.a.createElement(m.e,{className:"p-0 pb-3"},s.a.createElement("table",{className:"table mb-0"},s.a.createElement("thead",{className:"bg-light"},this.state.exportList.length>0&&s.a.createElement("tr",null,s.a.createElement("th",{scope:"col",className:"border-0"},"Created at"),s.a.createElement("th",{scope:"col",className:"border-0"},"Description"),s.a.createElement("th",{scope:"col",className:"border-0"},"Aggregation"),s.a.createElement("th",{scope:"col",className:"border-0"},"Variables"),s.a.createElement("th",{scope:"col",className:"border-0"},"Stations"),s.a.createElement("th",{scope:"col",className:"border-0"},"Status"))),s.a.createElement("tbody",null,this.state.exportList.slice(0,this.state.showNumber).map(function(t){return s.a.createElement("tr",null,s.a.createElement("td",null,s.a.createElement(ie.a,{date:t.createdAt,format:"YYYY-MM-DD HH:mm"})),s.a.createElement("td",null,t.description),s.a.createElement("td",null,e.state.aggregations[t.aggregation]),s.a.createElement("td",null,t.variables.length<=3&&s.a.createElement("span",null,t.variables.join(", ")),t.variables.length>3&&s.a.createElement("span",null,t.variables.length," variables")),s.a.createElement("td",null,t.stations.length<=3&&s.a.createElement("span",null,t.stations.join(", ")),t.stations.length>3&&s.a.createElement("span",null,t.stations.length," stations")),"completed"===t.status&&s.a.createElement("td",null,s.a.createElement("a",{href:"/download/export/"+t._id},"Download")),"completed"!==t.status&&s.a.createElement("td",null,t.status))}),0===this.state.exportList.length&&s.a.createElement("tr",null,s.a.createElement("td",{colspan:"5"},"You haven't generated any data exports yet.")))))))))}}]),t}(s.a.Component),oe=function(){return s.a.createElement(m.i,{fluid:!0,className:"main-content-container px-4"},s.a.createElement(ce,null),s.a.createElement(re,null))},me=function(e){function t(e){var a;return Object(p.a)(this,t),(a=Object(b.a)(this,Object(f.a)(t).call(this,e))).change=a.change.bind(Object(v.a)(Object(v.a)(a))),a.state={userList:[],demoList:[],filterUserType:""},a}return Object(E.a)(t,e),Object(g.a)(t,[{key:"change",value:function(e,t){var a={};a[e]=t,this.setState(Object(B.a)({},this.state,a))}},{key:"componentDidMount",value:function(){var e=this;_.a.get("/users").then(function(e){return e.data}).then(function(t){return e.setState({userList:t.users.filter(function(e){return e.access}),demoList:t.users.filter(function(e){return!e.access})})})}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{id:"user-overview"},s.a.createElement(m.A,{noGutters:!0,className:"page-header py-4"},s.a.createElement(ne,{sm:"4",title:"User overview",subtitle:"",className:"text-sm-left"})),s.a.createElement(N.a,{to:"/add-user"},s.a.createElement(m.c,{theme:"primary",className:"mb-4 mr-1"},"Create user")),s.a.createElement(m.A,null,s.a.createElement(m.g,null,s.a.createElement(m.d,{small:!0,className:"mb-4"},s.a.createElement(m.f,{className:"border-bottom"},s.a.createElement("h6",{className:"m-0"},"User list (",this.state.userList.length,")")),s.a.createElement(m.e,{className:"p-0 pb-3"},s.a.createElement("table",{className:"table mb-0"},s.a.createElement("thead",{className:"bg-light"},s.a.createElement("tr",null,s.a.createElement("th",{scope:"col",className:"border-0"},"Name"),s.a.createElement("th",{scope:"col",className:"border-0",style:{width:"30%"}},"Organisation"),s.a.createElement("th",{scope:"col",className:"border-0"},"E-mail"),s.a.createElement("th",{scope:"col",className:"border-0"},"Created"),s.a.createElement("th",{scope:"col",className:"border-0"},"Last active"),s.a.createElement("th",{scope:"col",className:"border-0"},"Action"))),s.a.createElement("tbody",null,this.state.userList.filter(function(t){return te.a.isEmpty(e.state.filterUserType)||t.userType===e.state.filterUserType}).map(function(e){return s.a.createElement("tr",null,s.a.createElement("td",null,e.profile.name,"admin"===e.role&&s.a.createElement("span",null,"\xa0",s.a.createElement("i",{className:"material-icons"},"grade"))),s.a.createElement("td",null,e.profile.company),s.a.createElement("td",null,e.email),s.a.createElement("td",null,e.createdAt&&s.a.createElement(ie.a,{date:e.createdAt,format:"YYYY-MM-DD"})),s.a.createElement("td",null,e.lastLogin&&s.a.createElement(ie.a,{date:e.lastLogin,format:"YYYY-MM-DD"})),s.a.createElement("td",null,s.a.createElement(N.a,{to:"/edit-user/"+e._id},"Edit")))}))))))))}}]),t}(s.a.Component),ue=function(){return s.a.createElement(m.i,{fluid:!0,className:"main-content-container px-4"},s.a.createElement(me,null))},de=function(e){function t(e){var a;return Object(p.a)(this,t),(a=Object(b.a)(this,Object(f.a)(t).call(this,e))).dateRangeReference=s.a.createRef(),a.handleVariableChange=a.handleVariableChange.bind(Object(v.a)(Object(v.a)(a))),a.handleStationChange=a.handleStationChange.bind(Object(v.a)(Object(v.a)(a))),a.handleAggregationChange=a.handleAggregationChange.bind(Object(v.a)(Object(v.a)(a))),a.change=a.change.bind(Object(v.a)(Object(v.a)(a))),a.submit=a.submit.bind(Object(v.a)(Object(v.a)(a))),a.updateStations=a.updateStations.bind(Object(v.a)(Object(v.a)(a))),a.updateVariables=a.updateVariables.bind(Object(v.a)(Object(v.a)(a))),a.state={submitLabel:"Create user",redirect:!1,variables:{ap:!0,pr:!0,rh:!0,ra:!0,te:!0,wd:!0,wg:!0,ws:!0},aggregationOptions:I.getAggregations(),aggregations:{},variableList:[],stations:{},stationList:[],filterString:"",filterSelected:"disabled",description:"",multiSelect:!1,userId:null,userType:"trial",user:null,name:"",email:"",organisation:"",role:"user",notify:"welcome",aggregationAccess:"unlimited",variableAccess:"standard",periodAccess:"unlimited",stationAccess:"unlimited"},a}return Object(E.a)(t,e),Object(g.a)(t,[{key:"change",value:function(e,t){var a={};a[e]=t,this.setState(Object(B.a)({},this.state,a))}},{key:"submit",value:function(){for(var e=this,t=[],a=[],n=[],s=this.dateRangeReference.current,r=null,l=null,i=0,c=Object.keys(this.state.stations);i<c.length;i++){var o=c[i];this.state.stations[o]&&t.push(o)}for(var m=0,u=Object.keys(this.state.variables);m<u.length;m++){var d=u[m];this.state.variables[d]&&a.push(d)}for(var h=0,p=Object.keys(this.state.aggregationOptions);h<p.length;h++){var g=p[h];this.state.aggregations[g]&&n.push(g)}s&&s.state.startDate&&s.state.startDate instanceof Date&&(r=s.state.startDate.getFullYear()+"-"+("0"+(s.state.startDate.getMonth()+1)).slice(-2)+"-"+("0"+s.state.startDate.getDate()).slice(-2)+"T00:00:00.000Z"),s&&s.state.endDate&&s.state.endDate instanceof Date&&(l=s.state.endDate.getFullYear()+"-"+("0"+(s.state.endDate.getMonth()+1)).slice(-2)+"-"+("0"+s.state.endDate.getDate()).slice(-2)+"T23:59:59.000Z");var b={stations:{unlimited:"unlimited"===this.state.stationAccess,specific:"stations"===this.state.stationAccess||"specific"===this.state.stationAccess?t:[]},variables:{unlimited:"unlimited"===this.state.variableAccess,standard:"standard"===this.state.variableAccess,specific:"specific"===this.state.variableAccess?a:[]},period:{unlimited:"unlimited"===this.state.periodAccess,startDate:"specific"===this.state.periodAccess&&r?r:null,endDate:(this.state.periodAccess,l)},aggregation:{unlimited:"unlimited"===this.state.aggregationAccess,specific:"specific"===this.state.aggregationAccess?n:[]}},f={name:this.state.name,company:this.state.organisation,email:this.state.email.trim(),role:this.state.role,userType:this.state.userType,notify:this.state.notify,access:b};_()({url:"/users"+(this.state.userId?"/"+this.state.userId:""),method:this.state.userId?"PUT":"POST",headers:{Accept:"application/json","Content-Type":"application/json"},data:f}).then(function(e){return e.data}).then(function(t){"success"===t.status?e.setState({redirect:!0}):alert("User create failed:\n"+t.error)}).catch(function(e){alert("User create failed.")})}},{key:"handleVariableChange",value:function(e,t){var a={variables:this.state.variables};a.variables[t]=!this.state.variables[t],this.setState(Object(B.a)({},this.state,a))}},{key:"handleStationChange",value:function(e,t){var a={stations:this.state.stations};a.stations[t]=!this.state.stations[t],this.setState(Object(B.a)({},this.state,a))}},{key:"handleAggregationChange",value:function(e,t){var a={aggregations:this.state.aggregations};a.aggregations[t]=!this.state.aggregations[t],this.setState(Object(B.a)({},this.state,a))}},{key:"handleMultiSelectChange",value:function(){var e=this,t=!this.state.multiSelect,a=this.state.stations;this.state.stationList.filter(function(t){return(t.location.name.toLowerCase().includes(e.state.filterString)||t.code.toLowerCase().includes(e.state.filterString))&&("disabled"===e.state.filterSelected||e.state.stations[t.code])}).map(function(e){a[e.code]=t});var n={multiSelect:t,stations:a};this.setState(Object(B.a)({},this.state,n))}},{key:"componentDidMount",value:function(){var e=this;this.props.id&&(this.setState({userId:this.props.id,submitLabel:"Edit user"}),_.a.get("/users/"+this.props.id).then(function(e){return e.data}).then(function(t){if(t.user&&(e.setState({user:t.user,name:t.user.profile.name,organisation:t.user.profile.company,email:t.user.email,role:t.user.role,userType:t.user.userType?t.user.userType:"trial",notify:""}),t.user.access)){var a=t.user.access;e.setState({aggregationAccess:a.aggregation.unlimited?"unlimited":"specific",variableAccess:a.variables.unlimited?"unlimited":a.variables.standard?"standard":"specific",periodAccess:a.period.unlimited?"unlimited":"specific",stationAccess:a.stations.unlimited?"unlimited":"specific",variables:te.a.zipObject(a.variables.specific,a.variables.specific.map(function(e){return!0})),stations:te.a.zipObject(a.stations.specific,a.stations.specific.map(function(e){return!0})),aggregations:te.a.zipObject(a.aggregation.specific,a.aggregation.specific.map(function(e){return!0}))}),!1===a.period.unlimited&&e.dateRangeReference&&e.dateRangeReference.current.setDates(a.period.startDate,a.period.endDate)}})),L.dispatch({actionType:C})}},{key:"updateStations",value:function(){var e=I.getAccessStationCodes(),t=I.getStations().filter(function(t){return-1!==e.indexOf(t.code)});this.setState({stationList:t})}},{key:"updateVariables",value:function(){var e=I.getAccessVariableCodes(),t=I.getVariables().filter(function(t){return-1!==e.indexOf(t.shortcode)});this.setState({variableList:t})}},{key:"componentWillMount",value:function(){I.on(A,this.updateStations),I.on(k,this.updateVariables)}},{key:"componentWillUnmount",value:function(){I.removeListener(A,this.updateStations),I.removeListener(k,this.updateVariables)}},{key:"render",value:function(){var e=this;return!0===this.state.redirect?s.a.createElement(o.a,{to:"/user-management"}):s.a.createElement("div",{id:"user-overview"},s.a.createElement(m.A,{noGutters:!0,className:"page-header py-4"},s.a.createElement(ne,{sm:"4",title:"User",subtitle:this.state.submitLabel,className:"text-sm-left"})),s.a.createElement(m.A,null,s.a.createElement(m.g,null,s.a.createElement(m.d,{small:!0,className:"mb-4"},s.a.createElement(m.f,{className:"border-bottom"},s.a.createElement("h6",{className:"m-0"},"General")),s.a.createElement(m.e,{className:"pt-0"},s.a.createElement(m.A,{className:"border-bottom"},s.a.createElement(m.g,{sm:"3",className:"d-flex mb-3 mt-3"},"Name"),s.a.createElement(m.g,{sm:"3",className:"d-flex mb-2 mt-2"},s.a.createElement(m.q,{placeholder:"",value:this.state.name,onChange:function(t){return e.change("name",t.target.value)}}))),s.a.createElement(m.A,{className:"border-bottom"},s.a.createElement(m.g,{sm:"3",className:"d-flex mb-3 mt-3"},"Email"),s.a.createElement(m.g,{sm:"3",className:"d-flex mb-2 mt-2"},s.a.createElement(m.q,{placeholder:"",value:this.state.email,onChange:function(t){return e.change("email",t.target.value)}}))),s.a.createElement(m.A,{className:"border-bottom"},s.a.createElement(m.g,{sm:"3",className:"d-flex mb-3 mt-3"},"Organisation"),s.a.createElement(m.g,{sm:"3",className:"d-flex mb-2 mt-2"},s.a.createElement(m.q,{placeholder:"",value:this.state.organisation,onChange:function(t){return e.change("organisation",t.target.value)}}))),s.a.createElement(m.A,{className:"border-bottom"},s.a.createElement(m.g,{sm:"3",className:"d-flex mb-2 mt-3"},"Role"),s.a.createElement(m.g,{sm:"3",className:"d-flex mb-2 mt-2"},s.a.createElement(m.s,null,s.a.createElement(m.r,{value:this.state.role,onChange:function(t){return e.change("role",t.target.value)}},s.a.createElement("option",{value:"user"},"User"),s.a.createElement("option",{value:"admin"},"Admin"))))),s.a.createElement(m.A,null,s.a.createElement(m.g,{sm:"3",className:"d-flex mb-2 mt-3"},"Notify by email"),s.a.createElement(m.g,{sm:"3",className:"d-flex mb-2 mt-2"},s.a.createElement(m.s,null,s.a.createElement(m.r,{value:this.state.notify,onChange:function(t){return e.change("notify",t.target.value)}},s.a.createElement("option",{value:""},"None"),s.a.createElement("option",{value:"welcome"},"Welcome"),s.a.createElement("option",{value:"update"},"Access update"),s.a.createElement("option",{value:"migration"},"Migration"))))))))),s.a.createElement(m.A,null,s.a.createElement(m.g,null,s.a.createElement(m.d,{small:!0,className:"mb-4"},s.a.createElement(m.f,{className:"border-bottom"},s.a.createElement("h6",{className:"m-0"},"Access")),s.a.createElement(m.e,{className:"pt-0"},s.a.createElement(m.A,{className:"border-bottom"},s.a.createElement(m.g,{sm:"3",className:"d-flex mb-2 mt-3"},"Data sets / aggregation"),s.a.createElement(m.g,{sm:"3",className:"d-flex mb-2 mt-2"},s.a.createElement(m.s,null,s.a.createElement(m.r,{value:this.state.aggregationAccess,onChange:function(t){return e.change("aggregationAccess",t.target.value)}},s.a.createElement("option",{value:"unlimited"},"All"),s.a.createElement("option",{value:"specific"},"Specific"))))),"specific"===this.state.aggregationAccess&&s.a.createElement(m.A,{className:"border-bottom"},s.a.createElement(m.g,{sm:"3",className:"d-flex mb-3 mt-3"},"Specify data sets"),s.a.createElement(m.g,{sm:"4",md:"3",className:"mb-2 mt-2"},s.a.createElement("fieldset",null,Object.keys(this.state.aggregationOptions).map(function(t){return s.a.createElement(m.p,{checked:e.state.aggregations[t],onChange:function(a){return e.handleAggregationChange(a,t)}},e.state.aggregationOptions[t])})))),s.a.createElement(m.A,{className:"border-bottom"},s.a.createElement(m.g,{sm:"3",className:"d-flex mb-2 mt-3"},"Variables"),s.a.createElement(m.g,{sm:"3",className:"d-flex mb-2 mt-2"},s.a.createElement(m.s,null,s.a.createElement(m.r,{value:this.state.variableAccess,onChange:function(t){return e.change("variableAccess",t.target.value)}},s.a.createElement("option",{value:"unlimited"},"All"),s.a.createElement("option",{value:"standard"},"Standard"),s.a.createElement("option",{value:"specific"},"Specific"))))),"specific"===this.state.variableAccess&&s.a.createElement(m.A,{className:"border-bottom"},s.a.createElement(m.g,{sm:"3",className:"d-flex mb-3 mt-3"},"Specify variables"),s.a.createElement(m.g,{sm:"4",md:"3",className:"mb-2 mt-2"},s.a.createElement("strong",{className:"text-muted d-block mb-2"},"Standard variables"),s.a.createElement("fieldset",null,this.state.variableList.filter(function(e){return!0===e.standard}).map(function(t){return s.a.createElement(m.p,{checked:e.state.variables[t.shortcode],onChange:function(a){return e.handleVariableChange(a,t.shortcode)}},t.description)}))),this.state.variableList.filter(function(e){return!1===e.standard}).length>0&&s.a.createElement(m.g,{sm:"4",md:"3",className:"mb-2 mt-2"},s.a.createElement("strong",{className:"text-muted d-block mb-2"},"Other variables"),s.a.createElement("fieldset",null,this.state.variableList.filter(function(e){return!1===e.standard}).map(function(t){return s.a.createElement(m.p,{checked:e.state.variables[t.shortcode],onChange:function(a){return e.handleVariableChange(a,t.shortcode)}},t.description)})))),s.a.createElement(m.A,{className:"border-bottom"},s.a.createElement(m.g,{sm:"3",className:"d-flex mb-2 mt-3"},"Period"),s.a.createElement(m.g,{sm:"3",className:"d-flex mb-2 mt-2"},s.a.createElement(m.s,null,s.a.createElement(m.r,{value:this.state.periodAccess,onChange:function(t){return e.change("periodAccess",t.target.value)}},s.a.createElement("option",{value:"unlimited"},"All"),s.a.createElement("option",{value:"specific"},"Specific"))))),"specific"===this.state.periodAccess&&s.a.createElement(m.A,{className:"border-bottom"},s.a.createElement(m.g,{sm:"3",className:"d-flex mb-3 mt-3"},"Specify period"),s.a.createElement(m.g,{sm:"3",className:"d-flex mb-2 mt-2"},s.a.createElement(se,{ref:this.dateRangeReference}))),s.a.createElement(m.A,{className:"border-bottom"},s.a.createElement(m.g,{sm:"3",className:"d-flex mb-2 mt-3"},"Stations"),s.a.createElement(m.g,{sm:"3",className:"d-flex mb-2 mt-2"},s.a.createElement(m.s,null,s.a.createElement(m.r,{value:this.state.stationAccess,onChange:function(t){return e.change("stationAccess",t.target.value)}},s.a.createElement("option",{value:"unlimited"},"All"),s.a.createElement("option",{value:"stations"},"Choose individual stations"))))))))),("stations"===this.state.stationAccess||"specific"===this.state.stationAccess)&&s.a.createElement(m.A,null,s.a.createElement(m.g,null,s.a.createElement(m.d,{small:!0,className:"mb-2"},s.a.createElement(m.f,{className:"border-bottom"},s.a.createElement("h6",{className:"m-0"},"Specify individual stations")),s.a.createElement(m.e,{className:"p-0 pb-3"},s.a.createElement(m.A,{className:"border-bottom"},s.a.createElement(m.g,{sm:"3",className:"d-flex mb-2 mt-3 ml-3"},s.a.createElement(m.s,{className:"mb-3"},s.a.createElement(m.t,{type:"prepend"},s.a.createElement(m.u,null,"Filter")),s.a.createElement(m.q,{onChange:function(t){return e.change("filterString",t.target.value.toLowerCase())},placeholder:"e.g. station id or station name"}))),s.a.createElement(m.g,{sm:"2",className:"d-flex mb-2 mt-3"},s.a.createElement(m.s,{className:"mb-3"},s.a.createElement(m.t,{type:"prepend"},s.a.createElement(m.u,null,"Show only selected")),s.a.createElement(m.r,{onChange:function(t){return e.change("filterSelected",t.target.value)}},s.a.createElement("option",{value:"disabled"},"Disabled"),s.a.createElement("option",{value:"enabled"},"Enabled"))))),s.a.createElement("table",{className:"table mb-0"},s.a.createElement("thead",{className:"bg-light"},s.a.createElement("tr",null,s.a.createElement("th",{scope:"col",className:"border-0"},s.a.createElement(m.p,{className:"mb-0",checked:this.state.multiSelect,onChange:function(t){return e.handleMultiSelectChange(t)}})),s.a.createElement("th",{scope:"col",className:"border-0"},"Station id"),s.a.createElement("th",{scope:"col",className:"border-0"},"Location name"),s.a.createElement("th",{scope:"col",className:"border-0"},"Latitude"),s.a.createElement("th",{scope:"col",className:"border-0"},"Longitude"))),s.a.createElement("tbody",null,this.state.stationList.filter(function(t){return(t.location.name.toLowerCase().includes(e.state.filterString)||t.code.toLowerCase().includes(e.state.filterString))&&("disabled"===e.state.filterSelected||e.state.stations[t.code])}).map(function(t){return s.a.createElement("tr",null,s.a.createElement("td",null,s.a.createElement(m.p,{className:"mb-0",checked:e.state.stations[t.code],onChange:function(a){return e.handleStationChange(a,t.code)}})),s.a.createElement("td",null,t.code),s.a.createElement("td",null,t.location.name),s.a.createElement("td",null,t.location.latitude),s.a.createElement("td",null,t.location.longitude))}))))))),s.a.createElement(m.c,{theme:"primary",onClick:this.submit,className:"mb-4 mr-1"},this.state.submitLabel))}}]),t}(s.a.Component),he=function(e){function t(){return Object(p.a)(this,t),Object(b.a)(this,Object(f.a)(t).apply(this,arguments))}return Object(E.a)(t,e),Object(g.a)(t,[{key:"render",value:function(){return s.a.createElement(m.i,{fluid:!0,className:"main-content-container px-4"},s.a.createElement(de,null))}}]),t}(s.a.Component),pe=function(e){function t(e){var a;return Object(p.a)(this,t),(a=Object(b.a)(this,Object(f.a)(t).call(this,e))).state={userId:e.match.params.id},a}return Object(E.a)(t,e),Object(g.a)(t,[{key:"render",value:function(){return s.a.createElement(m.i,{fluid:!0,className:"main-content-container px-4"},s.a.createElement(de,{id:this.state.userId}))}}]),t}(s.a.Component),ge=a(148),be=a(150),fe=a(147),Ee=a(151),ve=(a(123),a(16)),ye=a.n(ve),Ne=a(71);delete ye.a.Icon.Default.prototype._getIconUrl,ye.a.Icon.Default.mergeOptions({iconRetinaUrl:a(125),iconUrl:a(126),shadowUrl:a(127)});var Oe=function(e){function t(e){var a;return Object(p.a)(this,t),(a=Object(b.a)(this,Object(f.a)(t).call(this,e))).submit=a.submit.bind(Object(v.a)(Object(v.a)(a))),a.updateStations=a.updateStations.bind(Object(v.a)(Object(v.a)(a))),a.state={bounds:[[-11.710923,41.137109],[-26.2891802,52.3832053]],stationList:[],availableCountries:[],valueList:{},valueActive:!1},a}return Object(E.a)(t,e),Object(g.a)(t,[{key:"updateStations",value:function(){var e=I.getStations(),t=te.a.uniq(te.a.map(e,function(e){return e.location.countrycode}));this.setState({stationList:e,availableCountries:t})}},{key:"componentWillMount",value:function(){I.on(A,this.updateStations)}},{key:"componentWillUnmount",value:function(){I.removeListener(A,this.updateStations)}},{key:"componentDidMount",value:function(){L.dispatch({actionType:C})}},{key:"submit",value:function(){var e=this,t=[],a={variable:"pr",stations:this.state.stationList.filter(function(e){return"KE"===e.location.countrycode||"UG"===e.location.countrycode}).map(function(e){return e.code}),startDate:null,endDate:null},n=!0,s=!1,r=void 0;try{for(var l,i=this.state.stationList[Symbol.iterator]();!(n=(l=i.next()).done);n=!0)l.value}catch(c){s=!0,r=c}finally{try{n||null==i.return||i.return()}finally{if(s)throw r}}if(0==a.stations.length&&t.push("There are no stations selected."),t.length>0)return alert("Map update failed:\n"+t.join("\n")),!1;a.startDate="2020-12-01T00:00:00Z",a.endDate="2020-12-31T23:59:00Z",_()({url:"/map",method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},data:a}).then(function(e){return e.data}).then(function(t){t.error?alert("Creating map failed:\n"+t.error):e.setState({valueList:t,valueActive:!0})}).catch(function(e){alert("Creating map failed.")})}},{key:"render",value:function(){var e=this;return s.a.createElement("div",null,s.a.createElement(ge.a,{bounds:this.state.bounds,style:{height:"calc(100vh)"},maxZoom:11},s.a.createElement(be.a,{attribution:'Tiles \xa9 <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',url:"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png"}),!this.state.valueActive&&this.state.stationList.map(function(e){return s.a.createElement(fe.a,{position:[e.location.latitude,e.location.longitude]},s.a.createElement(Ee.a,null,s.a.createElement("span",null,"".concat(e.code," ").concat(e.location.name))))}),this.state.valueActive&&this.state.stationList.filter(function(t){return void 0!==e.state.valueList[t.code]}).map(function(t){var a=e.state.valueList[t.code],n=(100-Math.min(100,a/3)).toFixed(0),r="\thsl(240, 60%, ".concat(n,"%)");return s.a.createElement(Ne.a,{center:[t.location.latitude,t.location.longitude],fillColor:r,color:"black",weight:1,fillOpacity:1,radius:6},s.a.createElement(Ee.a,null,s.a.createElement("span",null,"".concat(t.code," ").concat(t.location.name,": ").concat(a.toFixed(1)))))})))}}]),t}(s.a.Component),je=(a(130),function(){return s.a.createElement(m.i,{fluid:!0,className:"main-content-container no-padding"},s.a.createElement(Oe,null))}),De=a(70),Se=a.n(De),xe=function(e){function t(e){var a;Object(p.a)(this,t),(a=Object(b.a)(this,Object(f.a)(t).call(this,e))).dateRangeReference=s.a.createRef(),a.handleStationChange=a.handleStationChange.bind(Object(v.a)(Object(v.a)(a))),a.change=a.change.bind(Object(v.a)(Object(v.a)(a))),a.changeVariable=a.changeVariable.bind(Object(v.a)(Object(v.a)(a))),a.submit=a.submit.bind(Object(v.a)(Object(v.a)(a))),a.hideGraph=a.hideGraph.bind(Object(v.a)(Object(v.a)(a))),a.updateStations=a.updateStations.bind(Object(v.a)(Object(v.a)(a))),a.updateVariables=a.updateVariables.bind(Object(v.a)(Object(v.a)(a))),a.updateAccess=a.updateAccess.bind(Object(v.a)(Object(v.a)(a)));return a.state={startDate:"",endDate:"",aggregation:null,variable:"ap",period:"week",type:"line",variableList:[],hideVariables:["wd","wg"],stations:{},stationList:[],filterString:"",aggregations:I.getAggregations(),aggregationAccess:[],graphTypeLabels:{"hourly-line":"Line graph (1 hour values)","daily-line":"Line graph (daily values)","hourly-bar":"Bar graph (hourly values)","daily-bar":"Bar graph (daily values)",windrose:"Wind rose"},availableGraphTypesByVariable:{pr:["hourly-bar","daily-bar"],ws:["windrose"],default:["hourly-line","daily-line"]},minDate:new Date("1970-01-01"),maxDate:new Date,showGraph:!1,graphData:[],graphTitle:"",graphUnits:"",graphType:"scatter"},a}return Object(E.a)(t,e),Object(g.a)(t,[{key:"change",value:function(e,t){var a={};a[e]=t,this.setState(a)}},{key:"changeVariable",value:function(e){var t={};t.variable=e,t.type=this.state.availableGraphTypesByVariable[e]?this.state.availableGraphTypesByVariable[e][0]:this.state.availableGraphTypesByVariable.default[0],this.setState(t)}},{key:"handleStationChange",value:function(e,t){var a={stations:this.state.stations};a.stations[t]=!this.state.stations[t],this.setState(a)}},{key:"submit",value:function(){var e=this,t=[],a=this.dateRangeReference.current,n={variable:this.state.variable,type:this.state.type,stations:[],period:this.state.period,startDate:null,endDate:null,aggregation:{"hourly-bar":"1h","daily-bar":"1d","hourly-line":"1h","daily-line":"1d"}[this.state.type]};"custom"===n.period&&(!a.state.startDate||!a.state.startDate instanceof Date)&&t.push("Invalid start date"),"custom"===n.period&&(!a.state.endDate||!a.state.endDate instanceof Date)&&t.push("Invalid end date");for(var s=0,r=Object.keys(this.state.stations);s<r.length;s++){var l=r[s];this.state.stations[l]&&n.stations.push(l)}if(0==n.stations.length&&t.push("There are no stations selected."),t.length>0)return alert("Graph plotting failed:\n"+t.join("\n")),!1;"custom"===n.period&&(n.startDate=a.state.startDate.getFullYear()+"-"+("0"+(a.state.startDate.getMonth()+1)).slice(-2)+"-"+("0"+a.state.startDate.getDate()).slice(-2)+"T00:00:00.000Z",n.endDate=a.state.endDate.getFullYear()+"-"+("0"+(a.state.endDate.getMonth()+1)).slice(-2)+"-"+("0"+a.state.endDate.getDate()).slice(-2)+"T23:59:59.000Z"),this.showGraph(),_()({url:"/graph",method:"POST",headers:{Accept:"application/json","Content-Type":"application/json"},data:n}).then(function(e){return e.data}).then(function(t){if(Array.isArray(t)){var a=e.state.variableList.find(function(t){return t.shortcode===e.state.variable}).description,n={ap:"kPa",pr:"mm",rh:"-",ra:"W/m2",te:"deg C",ws:"m/s"}[e.state.variable],s="scatter";"windrose"===e.state.type||"bar"===e.state.type.slice(-3)&&(s="bar");var r=t.map(function(e){return{x:e.timestamps,y:e.values,type:s,mode:"lines",name:e.station}});e.setState({graphData:r,graphType:s,graphTitle:a,graphUnits:n})}else e.hideGraph(),alert("Creating graph failed:\n"+t.error)}).catch(function(e){alert("Creating graph failed.")})}},{key:"showGraph",value:function(){this.setState({showGraph:!0})}},{key:"hideGraph",value:function(){this.setState({showGraph:!1,graphData:[]})}},{key:"updateStations",value:function(){var e=I.getAccessStationCodes(),t=I.getStations().filter(function(t){return-1!==e.indexOf(t.code)});this.setState({stationList:t})}},{key:"updateVariables",value:function(){var e=I.getAccessVariableCodes(),t=I.getVariables().filter(function(t){return-1!==e.indexOf(t.shortcode)});this.setState({variableList:t}),t.length&&t[0].shortcode&&this.changeVariable(t[0].shortcode)}},{key:"updateAccess",value:function(){var e=I.getUser();te.a.has(e,"access.period.unlimited")&&!0!==e.access.period.unlimited&&(this.setState({minDate:new Date(e.access.period.startDate),maxDate:new Date>new Date(e.access.period.endDate)?new Date(e.access.period.endDate):new Date}),this.dateRangeReference.current&&this.dateRangeReference.current.changeLimit(this.state.minDate,this.state.maxDate))}},{key:"componentWillMount",value:function(){I.on(A,this.updateStations),I.on(k,this.updateVariables),I.on(w,this.updateAccess)}},{key:"componentWillUnmount",value:function(){I.removeListener(A,this.updateStations),I.removeListener(k,this.updateVariables),I.removeListener(w,this.updateAccess)}},{key:"componentDidMount",value:function(){L.dispatch({actionType:C})}},{key:"render",value:function(){var e=this;return s.a.createElement("div",{id:"graph"},!1===this.state.showGraph&&s.a.createElement("div",null,s.a.createElement(m.A,{noGutters:!0,className:"page-header py-4"},s.a.createElement(ne,{sm:"4",title:"Configure graph",subtitle:"",className:"text-sm-left"})),s.a.createElement("div",null,s.a.createElement(m.A,null,s.a.createElement(m.g,null,s.a.createElement(m.d,{small:!0,className:"mb-4"},s.a.createElement(m.f,{className:"border-bottom"},s.a.createElement("h6",{className:"m-0"},"Graph settings")),s.a.createElement(m.e,{className:"pt-0"},s.a.createElement(m.A,{className:"border-bottom"},s.a.createElement(m.g,{sm:"3",className:"d-flex mb-2 mt-3"},"Variable"),s.a.createElement(m.g,{sm:"3",className:"d-flex mb-2 mt-2"},s.a.createElement(m.s,null,s.a.createElement(m.t,{type:"prepend"},s.a.createElement(m.u,null,"Variable")),s.a.createElement(m.r,{onChange:function(t){return e.changeVariable(t.target.value)}},this.state.variableList.filter(function(t){return-1===e.state.hideVariables.indexOf(t.shortcode)}).map(function(e){return s.a.createElement("option",{value:e.shortcode},e.description)}))))),s.a.createElement(m.A,{className:"border-bottom"},s.a.createElement(m.g,{sm:"3",className:"d-flex mb-2 mt-3"},"Graph"),s.a.createElement(m.g,{sm:"3",className:"d-flex mb-2 mt-2"},s.a.createElement(m.s,null,s.a.createElement(m.t,{type:"prepend"},s.a.createElement(m.u,null,"Type")),s.a.createElement(m.r,{onChange:function(t){return e.change("type",t.target.value)}},(this.state.availableGraphTypesByVariable[this.state.variable]?this.state.availableGraphTypesByVariable[this.state.variable]:this.state.availableGraphTypesByVariable.default).map(function(t){return s.a.createElement("option",{value:t},e.state.graphTypeLabels[t])}))))),s.a.createElement(m.A,{className:"".concat("custom"===this.state.period?"border-bottom":"")},s.a.createElement(m.g,{sm:"3",className:"d-flex mb-2 mt-3"},"Period"),s.a.createElement(m.g,{sm:"3",className:"d-flex mb-2 mt-2"},s.a.createElement(m.s,null,s.a.createElement(m.t,{type:"prepend"},s.a.createElement(m.u,null,"Period")),s.a.createElement(m.r,{onChange:function(t){return e.change("period",t.target.value)}},s.a.createElement("option",{value:"week"},"Last week"),s.a.createElement("option",{value:"month"},"Last month"),s.a.createElement("option",{value:"custom"},"Custom period"))))),"custom"===this.state.period&&s.a.createElement(m.A,null,s.a.createElement(m.g,{sm:"3",className:"d-flex mb-3 mt-3"},"Specify period"),s.a.createElement(m.g,{sm:"3",className:"d-flex mb-2 mt-2"},s.a.createElement(se,{ref:this.dateRangeReference,minDate:this.state.minDate,maxDate:this.state.maxDate}))))))),s.a.createElement(m.A,null,s.a.createElement(m.g,null,s.a.createElement(m.d,{small:!0,className:"mb-2 scroll-500"},s.a.createElement(m.f,{className:"border-bottom"},s.a.createElement("h6",{className:"m-0"},"Stations")),s.a.createElement(m.e,{className:"p-0 pb-3"},s.a.createElement(m.A,{className:"border-bottom"},s.a.createElement(m.g,{sm:"3",className:"d-flex mb-2 mt-3 ml-3"},s.a.createElement(m.s,{className:"mb-3"},s.a.createElement(m.t,{type:"prepend"},s.a.createElement(m.u,null,"Filter")),s.a.createElement(m.q,{onChange:function(t){return e.change("filterString",t.target.value.toLowerCase())},placeholder:"e.g. station id or station name"})))),s.a.createElement("table",{className:"table mb-0"},s.a.createElement("thead",{className:"bg-light"},s.a.createElement("tr",null,s.a.createElement("th",{scope:"col",className:"border-0"}),s.a.createElement("th",{scope:"col",className:"border-0"},"Station id"),s.a.createElement("th",{scope:"col",className:"border-0"},"Location name"),s.a.createElement("th",{scope:"col",className:"border-0"},"Latitude"),s.a.createElement("th",{scope:"col",className:"border-0"},"Longitude"))),s.a.createElement("tbody",null,this.state.stationList.filter(function(t){return t.location.name.toLowerCase().includes(e.state.filterString)||t.code.toLowerCase().includes(e.state.filterString)}).map(function(t){return s.a.createElement("tr",null,s.a.createElement("td",null,s.a.createElement(m.p,{className:"mb-0",checked:e.state.stations[t.code],onChange:function(a){return e.handleStationChange(a,t.code)}})),s.a.createElement("td",null,t.code),s.a.createElement("td",null,t.location.name),s.a.createElement("td",null,t.location.latitude),s.a.createElement("td",null,t.location.longitude))}))))),s.a.createElement(m.c,{theme:"primary",onClick:this.submit,className:"mb-4 mr-1"},"Create graph"))))),!0===this.state.showGraph&&s.a.createElement("div",null,s.a.createElement(m.A,{noGutters:!0,className:"page-header py-4"},s.a.createElement(ne,{sm:"4",title:"Graph",subtitle:"",className:"text-sm-left"})),s.a.createElement(m.A,null,s.a.createElement(m.g,null,this.state.graphData.length>0&&s.a.createElement(Se.a,{data:this.state.graphData,layout:{title:this.state.graphTitle,showlegend:!0,yaxis:{title:{text:this.state.graphUnits}},barmode:"bar"===this.state.graphType?"group":void 0},config:{displayModeBar:!0,modeBarButtonsToRemove:["pan2d","select2d","lasso2d","resetScale2d","zoomIn2d","zoomOut2d","toggleSpikelines","hoverClosestCartesian","hoverCompareCartesian"],displaylogo:!1}}),0===this.state.graphData.length&&s.a.createElement("p",null,"Loading graph data, please wait."))),this.state.graphData.length>0&&s.a.createElement(m.A,null,s.a.createElement(m.g,null,s.a.createElement(m.c,{theme:"primary",onClick:this.hideGraph,className:"mt-2 mb-2 mr-1"},"Back to configure graph")))))}}]),t}(s.a.Component),Ce=(a(135),[{path:"/",exact:!0,layout:Q,component:function(){return s.a.createElement(o.a,{to:"/map"})}},{path:"/map",layout:Q,component:je},{path:"/visualize",layout:Q,component:function(){return s.a.createElement(m.i,{fluid:!0,className:"main-content-container px-4"},s.a.createElement(xe,null))}},{path:"/export",layout:Q,component:oe},{path:"/user-management",layout:Q,component:ue},{path:"/add-user",layout:Q,component:he},{path:"/edit-user/:id",layout:Q,component:pe}]),Ae=a(40);Ae.a.initialize(Object({NODE_ENV:"production",PUBLIC_URL:"/portal",REACT_APP_BASENAME:"/portal"}).REACT_APP_GAID||"UA-115105611-X");var ke=function(e){arguments.length>1&&void 0!==arguments[1]&&arguments[1];return function(t){function a(){return Object(p.a)(this,a),Object(b.a)(this,Object(f.a)(a).apply(this,arguments))}return Object(E.a)(a,t),Object(g.a)(a,[{key:"componentDidMount",value:function(){var e=this.props.location.pathname+this.props.location.search;"".concat("/portal").concat(e)}},{key:"componentDidUpdate",value:function(e){var t=e.location.pathname+e.location.search,a=this.props.location.pathname+this.props.location.search;t!==a&&"".concat("/portal").concat(a)}},{key:"render",value:function(){return s.a.createElement(e,this.props)}}]),a}(n.Component)};a(137),a(139),Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));l.a.render(s.a.createElement(function(){return s.a.createElement(i.a,{basename:"/portal"},s.a.createElement("div",null,Ce.map(function(e,t){return s.a.createElement(c.a,{key:t,path:e.path,exact:e.exact,component:ke(function(t){return s.a.createElement(e.layout,t,s.a.createElement(e.component,t))})})})))},null),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})},73:function(e,t,a){e.exports=a(141)},99:function(e,t,a){e.exports=a.p+"static/media/0.73476783.jpg"}},[[73,2,1]]]);
//# sourceMappingURL=main.37d861f1.chunk.js.map